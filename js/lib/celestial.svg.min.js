!function(){var t,e,a,n,r,i={version:"0.5.10",container:null,data:[]},o=0,l=0,s=0,c=0,p=0;i.display=function(b){var k,M,z=i.container,I=[],C=0,O=!1;(t=P.set(b)).stars.size=t.stars.size||7,t.stars.exponent=t.stars.exponent||-.28,t.center=t.center||[0,0],t.lang&&-1!==t.lang.search(/^de|es$/)||(t.lang="name");var N=j(t.container);if(N){k="#"+t.container;var L=window.getComputedStyle(N,null);parseInt(L.width)||t.width||(N.style.width=q(N.parentNode.clientWidth))}else k="body",N=null;var G=[16,16],J=Tt(),Q=St(t.projection);if(t.lines.graticule.lat&&"outline"===t.lines.graticule.lat.pos[0]&&(Q.scale-=2),Q){var Z=t.transform||"equatorial",K=Q.ratio,X=J/K,tt=Q.scale*J/1024,et=t.stars.size,at=t.dsos.size||et,nt=t.stars.exponent,rt=t.dsos.exponent||nt,it=1,ot=At(t.center),lt=t.datapath||"";lt=lt.replace(/([^\/]$)/,"$1/"),"body"!=k&&(j(t.container).style.height=q(X)),e=i.projection(t.projection).rotate(ot).translate([J/2,X/2]).scale(tt),a=d3.geo.zoom().projection(e).center([J/2,X/2]).scaleExtent([tt,5*tt]).on("zoom.redraw",yt);var st=d3.selectAll("canvas");0===st[0].length&&(st=d3.select(k).append("canvas")),st.attr("width",J).attr("height",X);var ct=d3.selectAll("svg");0===ct[0].length&&(ct=d3.select(k).append("svg")),ct.attr("width",J).attr("height",X).attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("id",t.container+"-svg");var pt=C2S(J,X),dt=d3.geo.graticule().minorStep([15,10]);n=d3.geo.path().projection(e).context(pt),z?z.selectAll("*").remove():z=d3.select(k).append("container"),t.interactive?st.call(a):st.attr("style","cursor: default!important"),zt(Q.clip),d3.select(window).on("resize",mt),!0===t.controls&&null===j("celestial-zoomin")&&(d3.select(k).append("input").attr("type","button").attr("id","celestial-zoomin").attr("value","+").on("click",function(){ft(1.111)}),d3.select(k).append("input").attr("type","button").attr("id","celestial-zoomout").attr("value","−").on("click",function(){ft(.9)})),!0===t.location&&(r=d3.geo.circle().angle([90]),z.append("path").datum(r).attr("class","horizon"),null===j("loc")?function(t){var e=d3.select("#celestial-form").append("div").attr("id","loc"),a=new Date(wallConfig.mapOptions.date + ' ' + wallConfig.mapOptions.time),n=[0,0],r=d3.time.format("%Y-%m-%d %H:%M:%S"),o=a.getTimezoneOffset(),l=new $(function(t,e){j("datetime").value=p(t,e),o=e,d()}),s=e.append("div").attr("class","col");function c(){l.show(a)}function p(t,e){var a;if(e&&"0"!==e){var n=Math.floor(Math.abs(e)/60),i=Math.abs(e)-60*n;a=(e<0?" +":" −")+E(n)+E(i)}else a=" ±0000";return r(t)+a}function d(){var e=j("lon").value,l=j("lat").value,s=!!j("horizon-show").checked,c=(a=r.parse(j("datetime").value.slice(0,-6))).getTimezoneOffset(),p=new Date(a.valueOf()+6e4*(o-c));t.horizon.show=s,""!==e&&""!==l&&(n=[parseFloat(l),parseFloat(e)],(Y=i.getPoint(y.inverse(p,[90,0],n),t.transform))[2]=0,i.rotate({center:Y,horizon:t.horizon}))}s.append("label").attr("title","Location coordinates long/lat").attr("for","lat").html("Location"),s.append("input").attr("type","number").attr("id","lat").attr("title","Latitude").attr("placeholder","Latitude").attr("max","90").attr("min","-90").attr("step","0.0001").attr("value",n[0]).on("change",function(){!0===W(this)&&d()}),s.append("span").html("°"),s.append("input").attr("type","number").attr("id","lon").attr("title","Longitude").attr("placeholder","Longitude").attr("max","180").attr("min","-180").attr("step","0.0001").attr("value",n[1]).on("change",function(){!0===W(this)&&d()}),s.append("span").html("°"),"geolocation"in navigator&&s.append("input").attr("type","button").attr("value","Here").attr("id","here").on("click",function(){navigator.geolocation.getCurrentPosition(function(t){n=[t.coords.latitude.toFixed(4),t.coords.longitude.toFixed(4)],d3.select("#lat").attr("value",n[0]),d3.select("#lon").attr("value",n[1]),d()})}),s.append("label").attr("title","Local date/time").attr("for","datetime").html(" Date/time"),s.append("input").attr("type","text").attr("id","datetime").attr("title","Date and time").attr("value",p(a,o)).on("click",c,!0).on("input",function(){this.value=p(a,o),l.isVisible()||c()}),s.append("div").attr("id","datepick").on("click",c),s.append("input").attr("type","button").attr("value","Now").attr("id","now").on("click",function(){a.setTime(Date.now()),j("datetime").value=p(a,o),d()}),s.append("br"),s.append("label").attr("title","Show horizon marker").attr("for","horizon-show").html(" Horizon marker"),s.append("input").attr("type","checkbox").attr("id","horizon-show").property("checked",t.horizon.show).on("change",d),d3.select(document).on("mousedown",function(){!function(t,e){for(;t.parentNode;){if("celestial-date"===t.id)return!0;t=t.parentNode}return!1}(d3.event.target)&&l.isVisible()&&l.hide()}),setTimeout(d,1e3)}(t):ht({center:i.zenith()}),R(Q.clip)),!0===t.form&&null===j("params")&&function(t){var e=P.set(t),a=i.projections(),n=i.eulerAngles(),r=d3.select("#celestial-form").append("div").attr("class","ctrl").append("form").attr("id","params").attr("name","params").attr("method","get").attr("action","#"),o=r.append("div").attr("class","col");o.append("label").attr("title","Map width in pixel, 0 indicates full width").attr("for","width").html("Width "),o.append("input").attr("type","number").attr("maxlength","4").attr("max","20000").attr("min","0").attr("title","Map width").attr("id","width").attr("value",e.width).on("change",function(){var t=this.value;!1!==W(this)&&(e.width=t,i.resize({width:t}))}),o.append("span").html("px"),o.append("label").attr("title","Map projection, (hemi) indicates hemispherical projection").attr("for","projection").html("Projection");var l=o.append("select").attr("id","projection").on("change",function(){this&&(e.projection=this.value,i.reproject(e))}),s=0,c=Object.keys(a).map(function(t,n){var r=a[t].clip&&!0===a[t].clip?a[t].n+" (hemi)":a[t].n;return t===e.projection&&(s=n),{o:t,n:r}});function p(){!1!==W(this)&&!1!==d()&&i.rotate(e)}function d(){var t=j("centerx"),a=j("centery"),n=j("centerz");if(t&&a){if("equatorial"!==e.transform)e.center[0]=parseFloat(t.value);else{var r=parseFloat(t.value);e.center[0]=r>12?15*r-360:15*r}e.center[1]=parseFloat(a.value);var i=parseFloat(n.value);return e.center[2]=isNaN(i)?0:i,""!==t.value&&""!==a.value}}function u(){var t,a=this;switch(a.type){case"checkbox":t=a.checked,_(a);break;case"number":if(!1===W(a))return;t=parseFloat(a.value);break;case"color":if(!1===V(a))return;t=a.value;break;case"text":if(-1===a.id.search(/fill$/))return;if(!1===V(a))return;t=a.value}null!==t&&(function(t,a){var n=t.split("-");switch(n.length){case 1:e[n[0]]=a;break;case 2:e[n[0]][n[1]]=a;break;case 3:e[n[0]][n[1]][n[2]]=a}}(a.id,t),d(),i.apply(e))}l.selectAll("option").data(c).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),l.property("selectedIndex",s),s=0,o.append("label").attr("title","Coordinate space in which the map is displayed").attr("for","transform").html("Coordinates"),l=o.append("select").attr("id","transform").on("change",function(){var t=this.value,a=B(t,e.transform);null!==a&&(e.center[0]=a),e.transform=t,i.reload({transform:t})}),c=Object.keys(n).map(function(t,a){return t===e.transform&&(s=a),{o:t,n:t.replace(/^([a-z])/,function(t,e){return e.toUpperCase()})}}),l.selectAll("option").data(c).enter().append("option").attr("value",function(t){return t.o}).text(function(t){return t.n}),l.property("selectedIndex",s),o.append("br"),o.append("label").attr("title","Center coordinates long/lat in selected coordinate space").attr("for","centerx").html("Center"),o.append("input").attr("type","number").attr("id","centerx").attr("list","centerx-list").attr("title","Center right ascension/longitude").attr("max","24").attr("min","0").attr("step","0.1").on("change",p),o.append("span").attr("id","cxunit").html("h"),o.append("input").attr("type","number").attr("id","centery").attr("title","Center declination/latitude").attr("max","90").attr("min","-90").attr("step","0.1").on("change",p),o.append("span").html("°"),o.append("label").attr("title","Orientation").attr("for","centerz").html("Orientation"),o.append("input").attr("type","number").attr("id","centerz").attr("title","Center orientation").attr("max","180").attr("min","-180").attr("step","0.1").on("change",p),o.append("span").html("°"),o.append("label").attr("for","orientationfixed").html("Fixed"),o.append("input").attr("type","checkbox").attr("id","orientationfixed").property("checked",e.orientationfixed).on("change",u),e.fullwidth&&o.append("input").attr("type","button").attr("id","fullwidth").attr("value","◄ Full Width ►").on("click",function(){return j("sidebar-wrapper").style.display="none",j("outer-wrapper").style.width="100%",j("main-wrapper").style.width="100%",this.style.display="none",i.display(e),!1}),U(e.center,e.transform),(o=r.append("div").attr("class","col")).append("label").attr("class","header").attr("for","stars-show").html("Stars"),o.append("input").attr("type","checkbox").attr("id","stars-show").property("checked",e.stars.show).on("change",u),o.append("label").attr("for","stars-limit").html("down to magnitude"),o.append("input").attr("type","number").attr("id","stars-limit").attr("title","Star display limit (magnitude)").attr("value",e.stars.limit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",u),o.append("label").attr("for","stars-colors").html("with spectral colors"),o.append("input").attr("type","checkbox").attr("id","stars-colors").property("checked",e.stars.colors).on("change",u),o.append("label").attr("for","stars-color").html("or default color "),o.append("input").attr("type","color").attr("autocomplete","off").attr("id","stars-style-fill").attr("title","Star color").property("value",e.stars.style.fill).on("change",u),o.append("br"),o.append("label").attr("for","stars-names").html("Show designations"),o.append("input").attr("type","checkbox").attr("id","stars-names").property("checked",e.stars.names).on("change",u),o.append("label").attr("for","stars-namelimit").html("down to mag"),o.append("input").attr("type","number").attr("id","stars-namelimit").attr("title","Star designaton display limit (magnitude)").attr("value",e.stars.namelimit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",u),o.append("label").attr("for","stars-desig").attr("title","include HD/HIP designations").html("all"),o.append("input").attr("type","checkbox").attr("id","stars-desig").property("checked",e.stars.desig).on("change",u),o.append("label").attr("for","stars-proper").html("proper names"),o.append("input").attr("type","checkbox").attr("id","stars-proper").property("checked",e.stars.proper).on("change",u),o.append("label").attr("for","stars-propernamelimit").html("down to mag"),o.append("input").attr("type","number").attr("id","stars-propernamelimit").attr("title","Star name display limit (magnitude)").attr("value",e.stars.propernamelimit).attr("max","6").attr("min","-1").attr("step","0.1").on("change",u),o.append("br"),o.append("label").attr("for","stars-size").html("Stellar disk size: base"),o.append("input").attr("type","number").attr("id","stars-size").attr("title","Size of the displayed star disk; base").attr("value",e.stars.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",u),o.append("label").attr("for","stars-exponent").html(" * e ^ (exponent"),o.append("input").attr("type","number").attr("id","stars-exponent").attr("title","Size of the displayed star disk; exponent").attr("value",e.stars.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",u),o.append("span").text(" * (magnitude + 2))  [* adaptation]"),_(j("stars-show")),(o=r.append("div").attr("class","col")).append("label").attr("class","header").attr("title","Deep Space Objects").attr("for","dsos-show").html("DSOs"),o.append("input").attr("type","checkbox").attr("id","dsos-show").property("checked",e.dsos.show).on("change",u),o.append("label").attr("for","dsos-limit").html("down to mag"),o.append("input").attr("type","number").attr("id","dsos-limit").attr("title","DSO display limit (magnitude)").attr("value",e.dsos.limit).attr("max","6").attr("min","0").attr("step","0.1").on("change",u),o.append("label").attr("for","dsos-names").html("with names"),o.append("input").attr("type","checkbox").attr("id","dsos-names").property("checked",e.dsos.names).on("change",u),o.append("label").attr("for","dsos-desig").html("or designations"),o.append("input").attr("type","checkbox").attr("id","dsos-desig").property("checked",e.dsos.desig).on("change",u),o.append("label").attr("for","dsos-namelimit").html("down to mag"),o.append("input").attr("type","number").attr("id","dsos-namelimit").attr("title","DSO name display limit (magnitude)").attr("value",e.dsos.namelimit).attr("max","6").attr("min","0").attr("step","0.1").on("change",u),o.append("br"),o.append("label").attr("for","dsos-size").html("DSO symbol size: (base"),o.append("input").attr("type","number").attr("id","dsos-size").attr("title","Size of the displayed symbol: base").attr("value",e.dsos.size).attr("max","100").attr("min","0").attr("step","0.1").on("change",u),o.append("label").attr("for","dsos-exponent").html(" * 2 [* adaptation] - magnitude) ^ exponent"),o.append("input").attr("type","number").attr("id","dsos-exponent").attr("title","Size of the displayed symbol; exponent").attr("value",e.dsos.exponent).attr("max","3").attr("min","-1").attr("step","0.01").on("change",u),_(j("dsos-show")),(o=r.append("div").attr("class","col")).append("label").attr("class","header").html("Constellations"),o.append("label").attr("for","constellations-names").html("Show names"),o.append("input").attr("type","checkbox").attr("id","constellations-names").property("checked",e.constellations.names).on("change",u),o.append("label").attr("for","constellations-desig").html("abbreviated"),o.append("input").attr("type","checkbox").attr("id","constellations-desig").property("checked",e.constellations.desig).on("change",u),o.append("label").attr("for","constellations-lines").html("with lines"),o.append("input").attr("type","checkbox").attr("id","constellations-lines").property("checked",e.constellations.lines).on("change",u),o.append("label").attr("for","constellations-bounds").html("with boundaries"),o.append("input").attr("type","checkbox").attr("id","constellations-bounds").property("checked",e.constellations.bounds).on("change",u),_(j("constellations-names")),(o=r.append("div").attr("class","col")).append("label").attr("class","header").html("Lines"),o.append("label").attr("title","Laitudet/longitude grid lines").attr("for","lines-graticule").html("Graticule"),o.append("input").attr("type","checkbox").attr("id","lines-graticule-show").property("checked",e.lines.graticule.show).on("change",u),o.append("label").attr("for","lines-equatorial").html("Equator"),o.append("input").attr("type","checkbox").attr("id","lines-equatorial-show").property("checked",e.lines.equatorial.show).on("change",u),o.append("label").attr("for","lines-ecliptic").html("Ecliptic"),o.append("input").attr("type","checkbox").attr("id","lines-ecliptic-show").property("checked",e.lines.ecliptic.show).on("change",u),o.append("label").attr("for","lines-galactic").html("Galactic plane"),o.append("input").attr("type","checkbox").attr("id","lines-galactic-show").property("checked",e.lines.galactic.show).on("change",u),o.append("label").attr("for","lines-supergalactic").html("Supergalactic plane"),o.append("input").attr("type","checkbox").attr("id","lines-supergalactic-show").property("checked",e.lines.supergalactic.show).on("change",u),(o=r.append("div").attr("class","col")).append("label").attr("class","header").html("Other"),o.append("label").attr("for","mw-show").html("Milky Way"),o.append("input").attr("type","checkbox").attr("id","mw-show").property("checked",e.mw.show).on("change",u),o.append("label").attr("for","mw-style-fill").html(" color"),o.append("input").attr("type","color").attr("id","mw-style-fill").attr("title","Milky Way color").attr("value",e.mw.style.fill).on("change",u),o.append("label").attr("for","mw-style-opacity").html(" opacity"),o.append("input").attr("type","number").attr("id","mw-style-opacity").attr("title","Transparency of each Milky Way layer").attr("value",e.mw.style.opacity).attr("max","1").attr("min","0").attr("step","0.01").on("change",u),o.append("br"),o.append("label").attr("for","background").html("Background color"),o.append("input").attr("type","color").attr("id","background-fill").attr("title","Background color").attr("value",e.background.fill).on("change",u),o.append("label").attr("title","Star/DSO sizes are increased with higher zoom-levels").attr("for","adaptable").html("Adaptable object sizes"),o.append("input").attr("type","checkbox").attr("id","adaptable").property("checked",e.adaptable).on("change",u),function(){var t,e=/\d+(\.\d+)?/g,a={s:6,d:6},n=i.settings();null!==(t=n.dsos.data.match(e))&&(a.d=parseFloat(t[t.length-1])),6!=a.d&&(j("dsos-limit").max=a.d,j("dsos-namelimit").max=a.d),null!==(t=n.stars.data.match(e))&&(a.s=parseFloat(t[t.length-1])),6!=a.s&&(j("stars-limit").max=a.s,j("stars-namelimit").max=a.s)}(),B(e.transform)}(t),null===j("error")&&d3.select("body").append("div").attr("id","error"),this.container=z,this.clip=wt,this.map=n,this.mapProjection=e,this.context=pt,this.setStyle=kt,this.setTextStyle=xt,this.setConstStyle=Mt,this.redraw=yt,this.resize=function(e){e&&D(e,"width")&&(t.width=e.width),mt(!0)},this.reload=function(e){e&&D(e,"transform")&&("equatorial"===(Z=t.transform=e.transform)?dt.minorStep([15,10]):dt.minorStep([10,10]),z.selectAll("*").remove(),zt(),z.append("path").datum(r).attr("class","horizon"),ut())},this.apply=function(e){!function(e){t=t.set(e),yt()}(e)},this.reproject=function(t){return gt(t)},this.rotate=function(e){return e?ht(e):t.center},this.zoomBy=function(t){return t?ft(t):e.scale()/tt},this.color=function(e){return e&&D(t.dsos.symbols,e)?t.dsos.symbols[e].fill:"#000"},this.animate=function(t,e){t&&(I=t,C=0,O=!!e,jt())},this.stop=function(t){clearTimeout(M),!0===t&&(I=[])},this.go=function(t){I.length<1||(t&&t<I.length&&(C=t),jt())},ut()}function ut(){for(var e in t.lines)D(t.lines,e)&&("graticule"===e?(z.append("path").datum(dt).attr("class","graticule"),D(t.lines.graticule,"lon")&&t.lines.graticule.lon.pos.length>0&&z.selectAll(".gridvalues_lon").data(x("lon",t.lines.graticule.lon.pos)).enter().append("path").attr("class","graticule_lon"),D(t.lines.graticule,"lat")&&t.lines.graticule.lat.pos.length>0&&z.selectAll(".gridvalues_lat").data(x("lat",t.lines.graticule.lat.pos)).enter().append("path").attr("class","graticule_lat")):z.append("path").datum(d3.geo.circle().angle([90]).origin(g(u[e],v[Z]))).attr("class",e));d3.json(lt+"mw.json",function(t,e){if(t)return window.alert("Your Browser doesn't support local file loading or the file doesn't exist. See readme.md"),console.warn(t);var a=w(e,Z);z.selectAll(".mway").data(a.features).enter().append("path").attr("class","mw"),yt()}),d3.json(lt+"constellations.json",function(t,e){if(t)return console.warn(t);var a=w(e,Z);z.selectAll(".constnames").data(a.features).enter().append("text").attr("class","constname"),yt()}),d3.json(lt+"constellations.bounds.json",function(t,e){if(t)return console.warn(t);var a=w(e,Z);z.selectAll(".bounds").data(a.features).enter().append("path").attr("class","boundaryline"),yt()}),d3.json(lt+"constellations.lines.json",function(t,e){if(t)return console.warn(t);var a=w(e,Z);z.selectAll(".lines").data(a.features).enter().append("path").attr("class","constline"),yt()}),d3.json(lt+t.stars.data,function(t,e){if(t)return console.warn(t);var a=w(e,Z);z.selectAll(".stars").data(a.features).enter().append("path").attr("class","star"),yt()}),d3.json(lt+t.dsos.data,function(t,e){if(t)return console.warn(t);var a=w(e,Z);z.selectAll(".dsos").data(a.features).enter().append("path").attr("class","dso"),yt()}),i.data.length>0&&i.data.forEach(function(t){D(t,"file")?d3.json(t.file,t.callback):setTimeout(t.callback,0)},this)}function ft(t){if(t&&1!==t){var n=e.scale(),r=n*t,i=a.scaleExtent(),o=p*Math.sqrt(Math.abs(1-t));r<i[0]&&(r=i[0]),r>i[1]&&(r=i[1]);var l=d3.interpolateNumber(n,r);return d3.select({}).transition().duration(o).tween("scale",function(){return function(t){var a=l(t);e.scale(a),yt()}}).transition().duration(0).tween("scale",function(){a.scale(r),yt()}),o}}function ht(a){var n,r,i,c=t.center,p=e.rotate(),d=e.scale(),u=s,h=!1,g=t.orientationfixed;F(p[1],1)===-F(a.center[1],1)&&(h=!0),t=t.set(a);var v=F(d3.geo.distance(c,t.center),2),y=d3.geo.distance([c[2],0],[t.center[2],0]);return v<o&&y<o?(ot=At(t.center),e.rotate(ot),yt()):(r=d>tt*l?d3.interpolateNumber(d,tt):function(){return d},i=0===y?function(){return p[2]}:function(t,e,a){return t=(t*m+f)%f,e=(e*m+f)%f,Math.abs(t-e)>Math.PI&&(t>e?t-=f:e>t&&(e-=f)),d3.interpolateNumber(t/m,e/m)}(c[2],t.center[2]),v>3.14&&(t.center[0]-=.01),t.orientationfixed=!1,n=0===v?function(){return t.center}:d3.geo.interpolate(c,t.center),u=0!==v?u*v:u*y,d3.select({}).transition().duration(u).tween("center",function(){return function(t){var a=At(n(t));a[2]=i(t);var o=r(t<.5?t:1-t);h&&(a[1]=p[1]),e.scale(o),e.rotate(a),yt()}}).transition().duration(0).tween("center",function(){t.orientationfixed=g,ot=At(t.center),e.rotate(ot),yt()})),u}function mt(n){J=Tt(),(t.width!==J||n)&&(X=J/K,tt=Q.scale*J/1024,st.attr("width",J).attr("height",X),a.scaleExtent([tt,5*tt]).scale(tt),e.translate([J/2,X/2]).scale(tt),N&&(N.style.height=q(X)),yt())}function gt(r){var o=St(r.projection);if(o){var l=e.rotate(),s=e.center(),p=e.scale(),d=a.scaleExtent(),u=i.projection(t.projection).center(s).translate([J/2,X/2]).scale([d[0]]),f=c,h=0,m=d3.interpolateNumber(K,o.ratio);Q.clip!=o.clip&&(f=0);var g=i.projection(r.projection).center(s).translate([J/2,J/o.ratio/2]).scale([o.scale*J/1024]),v=t.adaptable;return p>d[0]?(h=ft(.1),setTimeout(gt,h,r),h+f):(R(o.clip),e=function(t,e){var a,n=d3.geo.projection(function(n,r){var i=t([n*=180/Math.PI,r*=180/Math.PI]),o=e([n,r]);return[(1-a)*i[0]+a*o[0],(a-1)*i[1]-a*o[1]]}).scale(1),r=n.center,i=n.translate;return n.alpha=function(o){if(!arguments.length)return a;a=+o;var l=t.center(),s=e.center(),c=t.translate(),p=e.translate();return r([(1-a)*l[0]+a*s[0],(1-a)*l[1]+a*s[1]]),i([(1-a)*c[0]+a*p[0],(1-a)*c[1]+a*p[1]]),n},delete n.translate,delete n.center,n.alpha(0)}(u,g),t.adaptable=!1,d3.select({}).transition().duration(f).tween("projection",function(){return function(t){e.alpha(t).rotate(l),n.projection(e),zt(o.clip),K=m(t),X=J/K,st.attr("width",J).attr("height",X),N&&(N.style.height=q(X)),yt()}}).transition().duration(0).tween("projection",function(){K=(Q=o).ratio,X=J/Q.ratio,tt=Q.scale*J/1024,st.attr("width",J).attr("height",X),N&&(N.style.height=q(X)),t.projection=r.projection,e=i.projection(r.projection).rotate(l).translate([J/2,X/2]).scale(tt),n.projection(e),zt(Q.clip),a.projection(e).scaleExtent([tt,5*tt]).scale(tt),t.adaptable=v,yt()}),f)}}var vt=null;function yt(){vt&&clearTimeout(vt),vt=setTimeout(()=>{!function(){var a=e.rotate();for(var o in t.adaptable&&(it=Math.sqrt(e.scale()/tt)),it||(it=1),et=t.stars.size,nt=t.stars.exponent,at=t.dsos.size||et,rt=t.dsos.exponent,t.orientationfixed&&(a[2]=t.center[2],e.rotate(a)),t.center=[-a[0],-a[1],a[2]],U(t.center,t.transform),pt=C2S(J,X),n=d3.geo.path().projection(e).context(pt),pt.clearRect(0,0,J+G[0],X+G[1]),bt(),t.mw.show&&z.selectAll(".mw").each(function(e){kt(t.mw.style),n(e),pt.fill()}),t.lines)D(t.lines,o)&&!0===t.lines[o].show&&(kt(t.lines[o]),z.selectAll("."+o).attr("d",n),pt.stroke());D(t.lines.graticule,"lon")&&(xt(t.lines.graticule.lon),z.selectAll(".graticule_lon").each(function(t,a){if(wt(t.geometry.coordinates)){var n=e(t.geometry.coordinates);Pt(n,t.properties.orientation),pt.fillText(t.properties.value,n[0],n[1])}})),D(t.lines.graticule,"lat")&&(xt(t.lines.graticule.lat),z.selectAll(".graticule_lat").each(function(t,a){if(wt(t.geometry.coordinates)){var n=e(t.geometry.coordinates);Pt(n,t.properties.orientation),pt.fillText(t.properties.value,n[0],n[1])}})),bt(!0),t.constellations.show&&(t.constellations.bounds&&(z.selectAll(".boundaryline").each(function(e){kt(t.constellations.boundstyle),n(e),pt.stroke()}),bt(!0)),t.constellations.names&&(xt(t.constellations.namestyle),z.selectAll(".constname").each(function(a){if(wt(a.geometry.coordinates)){Mt(a.properties.rank,t.constellations.namestyle.font);var n=e(a.geometry.coordinates);pt.fillText(function(e){return t.constellations.desig?e.properties.desig:e.properties[t.lang]}(a),n[0],n[1])}})),t.constellations.lines&&z.selectAll(".constline").each(function(e){kt(t.constellations.linestyle),n(e),pt.stroke()})),t.stars.show&&(kt(t.stars.style),z.selectAll(".star").each(function(a){if(wt(a.geometry.coordinates)&&a.properties.mag<=t.stars.limit){var n=e(a.geometry.coordinates),r=function(t){var e=t.properties.mag;if(null===e)return.1;var a=et*it*Math.exp(nt*(e+2));return Math.max(a,.1)}(a);pt.fillStyle=function(e){var a=e.properties.bv;return!t.stars.colors||isNaN(a)?t.stars.style.fill:T(a)}(a),pt.beginPath(),pt.arc(n[0],n[1],r,0,2*Math.PI),pt.closePath(),pt.fill(),t.stars.names&&a.properties.mag<=t.stars.namelimit*it&&(xt(t.stars.namestyle),pt.fillText(function(e){var a=e.properties.desig;return t.stars.desig?a:a.replace(/^(HD|HIP|V\d{3}).+/,"")}(a),n[0]+r,n[1])),t.stars.proper&&a.properties.mag<=t.stars.propernamelimit*it&&(xt(t.stars.propernamestyle),pt.fillText(function(t){return t.properties.name}(a),n[0]-r,n[1]))}})),t.dsos.show&&z.selectAll(".dso").each(function(a){if(wt(a.geometry.coordinates)&&It(a.properties,t.dsos.limit)){var n=e(a.geometry.coordinates),r=a.properties.type;kt(t.dsos.symbols[r]);var i=function(e,a){var n=e.properties,r=function(t){return t.mag&&999!=t.mag?Math.pow(2*at*it-t.mag,rt):Math.pow(parseInt(t.dim)*at*it/7,.5)}(n)||9,i=function(e){return e&&D(t.dsos.symbols,e)?t.dsos.symbols[e].shape:"circle"}(n.type);return A.symbol().type(i).size(r).position(a)(pt),Math.sqrt(r)/2}(a,n);D(t.dsos.symbols[r],"stroke")?pt.stroke():pt.fill(),t.dsos.names&&It(a.properties,t.dsos.namelimit)&&(xt(t.dsos.namestyle),pt.fillStyle=t.dsos.symbols[r].fill,pt.fillText(function(e){var a=e.properties;if(""!==a.name)return t.dsos.desig&&a.desig?a.desig:a.name}(a),n[0]+i,n[1]-i))}}),i.data.length>0&&i.data.forEach(function(t){t.redraw()}),t.location&&t.horizon.show&&!Q.clip&&(r.origin(i.nadir()),kt(t.horizon),z.selectAll(".horizon").datum(r).attr("d",n),pt.fill(),t.horizon.stroke&&pt.stroke()),t.controls&&function(t){var e=j("celestial-zoomin"),a=j("celestial-zoomout");e&&a&&(e.disabled=t>=4.99*tt,a.disabled=t<=tt)}(e.scale()),document.getElementById(t.container+"-svg").innerHTML=pt.getSvg().innerHTML}()},1e3)}function bt(a){var r=e.rotate();e.rotate([0,0]),kt(t.background),z.selectAll(".outline").attr("d",n),a?pt.stroke():pt.fill(),e.rotate(r)}function wt(e){return Q.clip&&d3.geo.distance(t.center,e)>h?0:1}function kt(t){pt.fillStyle=t.fill||null,pt.strokeStyle=t.stroke||null,pt.lineWidth=t.width||null,pt.globalAlpha=t.opacity||1,pt.font=t.font||"",pt.beginPath()}function xt(t){pt.fillStyle=t.fill,pt.textAlign=t.align||"left",pt.textBaseline=t.baseline||"bottom",pt.globalAlpha=t.opacity||1,pt.font=t.font}function Mt(t,e){H(e)?1===e.length?pt.font=e[0]:t>e.length?pt.font=e[e.length-1]:pt.font=e[t-1]:pt.font=e}function zt(t){t?(e.clipAngle(90),z.selectAll(".outline").remove(),z.append("path").datum(d3.geo.circle().angle([90])).attr("class","outline")):(e.clipAngle(null),z.selectAll(".outline").remove(),z.append("path").datum(dt.outline).attr("class","outline"))}function It(t,e){return 999===t.mag&&Math.sqrt(parseInt(t.dim))>e||999!==t.mag&&t.mag<=e}function Pt(t,e){for(var a=e.split(""),n="center",r="middle",i=a.length-1;i>=0;i--)switch(a[i]){case"N":r="bottom";break;case"S":r="top";break;case"E":n="left",t[0]+=2;break;case"W":n="right",t[0]-=2}return pt.textAlign=n,pt.textBaseline=r,t}function Tt(){return t.width&&t.width>0?t.width:N?N.clientWidth-G[0]:window.innerWidth-2*G[0]}function St(t){if(D(S,t)){var e=S[t];return D(e,"ratio")||(e.ratio=2),e}}function At(t){if(null===t)return[0,0,0];var e=d.equatorial;return t[2]||(t[2]=0),[e[0]-t[0],e[1]-t[1],e[2]+t[2]]}function jt(){if(I&&!(I.length<1)){var t,e=I[C];switch(e.param){case"projection":t=gt({projection:e.value});break;case"center":t=ht({center:e.value});break;case"zoom":t=ft(e.value)}e.callback&&setTimeout(e.callback,t),C++,!0===O&&C===I.length&&(C=0),t=0===e.duration||e.duration<t?t:e.duration,C<I.length&&(M=setTimeout(jt,t))}}},i.projection=function(t){var e,a,n;if(!D(S,t))throw new Error("Projection not supported: "+t);return e=S[t],a=null!==e.arg?d3.geo[t].raw(e.arg):d3.geo[t].raw,(n=function(t,e){return a(-t,e)}).invert=function(t,e){var n=a.invert(t,e);return n[0]*=-1,n},d3.geo.projection(n)};var d={equatorial:[0,0,0],ecliptic:[0,0,23.4393],galactic:[93.5949,28.9362,-58.5988],supergalactic:[137.31,59.5283,57.7303]},u={equatorial:[0,90],ecliptic:[-90,66.5607],galactic:[-167.1405,27.1283],supergalactic:[-76.2458,15.7089]};i.eulerAngles=function(){return d},i.poles=function(){return u};var f=2*Math.PI,h=Math.PI/2,m=Math.PI/180;function g(t,e){return function(t,e){var a,n,r,i,o,l,s,c,p;return e?((l=t[0])<0&&(l+=f),s=t[1],l-=e[0],i=e[1],o=e[2],a=Math.sin(s)*Math.sin(i)-Math.cos(s)*Math.cos(i)*Math.cos(l),Math.abs(a)<1e-5&&(a=-Math.cos(s+i)+Math.cos(s)*Math.cos(i)*(1-Math.cos(l))),n=-Math.cos(s)*Math.sin(l),(c=o+(0!==a||0!==n?Math.atan2(n,a):l-Math.PI))>Math.PI&&(c-=f),l%Math.PI==0?((p=s+Math.cos(l)*i)>h&&(p=Math.PI-p),p<-h&&(p=-Math.PI-p)):(r=Math.sin(s)*Math.cos(i)+Math.cos(s)*Math.sin(i)*Math.cos(l),Math.abs(r)>.99?(p=Math.abs(Math.acos(Math.sqrt(a*a+n*n))),r<0&&(p*=-1)):p=Math.asin(r)),[c,p]):t}(t.map(function(t){return t*m}),e).map(function(t){return t/m})}var v={ecliptic:[-90,23.4393,90],"inverse ecliptic":[90,23.4393,-90],galactic:[-167.1405,62.8717,122.9319],"inverse galactic":[122.9319,62.8717,-167.1405],supergalactic:[283.7542,74.2911,26.4504],"inverse supergalactic":[26.4504,74.2911,283.7542],init:function(){for(var t in this)this[t].constructor==Array&&(this[t]=this[t].map(function(t){return t*m}))},add:function(t,e){if(e&&t&&3===e.length&&!this.hasOwnProperty(t))return this[t]=e.map(function(t){return t*m}),this[t]}};v.init(),i.euler=function(){return v};var y=function(t,e,a){var n=b(t,a[1])-e[0];n<0&&(n+=360),n*=m;var r=e[1]*m,i=a[0]*m,o=Math.asin(Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos(n)),l=Math.acos((Math.sin(r)-Math.sin(o)*Math.sin(i))/(Math.cos(o)*Math.cos(i)));return Math.sin(n)>0&&(l=2*Math.PI-l),[o/m,l/m,0]};function b(t,e){var a=t.getUTCFullYear(),n=t.getUTCMonth()+1,r=t.getUTCDate(),i=t.getUTCHours(),o=t.getUTCMinutes(),l=t.getUTCSeconds();1!=n&&2!=n||(a-=1,n+=12);var s=Math.floor(a/100),c=2-s+Math.floor(s/4)+Math.floor(365.25*a)+Math.floor(30.6001*(n+1))-730550.5+r+(i+o/60+l/3600)/24,p=c/36525,d=280.46061837+360.98564736629*c+387933e-9*p*p-p*p*p/3871e4+e;if(d>0)for(;d>360;)d-=360;else for(;d<0;)d+=360;return d}function w(t,e){if("equatorial"===e)return t;for(var a=v[e],n=t.features,r=0;r<n.length;r++)n[r].geometry.coordinates=k(n[r],a);return t}function k(t,e){var a=[];switch(t.geometry.type){case"Point":a=g(t.geometry.coordinates,e);break;case"LineString":a.push(z(t.geometry.coordinates,e));break;case"MultiLineString":a=I(t.geometry.coordinates,e);break;case"Polygon":a.push(z(t.geometry.coordinates[0],e));break;case"MultiPolygon":a.push(I(t.geometry.coordinates[0],e))}return a}function x(e,a){var n=[];if(!a)return[];H(a)||(a=[a]);for(var r=0;r<a.length;r++)switch(a[r]){case"center":n="lat"===e?n.concat(M(e,t.center[0],"N")):n.concat(M(e,t.center[1],"S"));break;case"outline":n="lon"===e?(n=n.concat(M(e,t.center[1]-89.99,"S"))).concat(M(e,t.center[1]+89.99),"N"):(n=n.concat(M(e,t.center[0]-179.99,"E"))).concat(M(e,t.center[0]+179.99,"W"));break;default:if(C(a[r])){n="lat"===e?n.concat(M(e,a[r],"N")):n.concat(M(e,a[r],"S"));break}}return function(t){for(var e=[],a=0;a<t.length;a++){var n={type:"Feature",id:a,properties:{},geometry:{type:"Point"}};n.properties.value=t[a].value,n.properties.orientation=t[a].orientation,n.geometry.coordinates=t[a].coordinates,e.push(n)}return e}(n)}function M(e,a,n){var r,i,o,l,s,c=e,p=[],d=a;"equatorial"===t.transform&&"lon"===c&&(c="ra"),"ra"===c?(r=0,i=23,o=1):"lon"===c?(r=0,i=350,o=10):(r=-80,i=80,o=10);for(var u=r;u<=i;u+=o){var f=n;"lat"===c?(s=[d,u],l=u.toString()+"°",f+=u<0?"S":"N"):"ra"===c?(s=[15*u,d],l=u.toString()+"ʰ"):(s=[u,d],l=u.toString()+"°"),p.push({coordinates:s,value:l,orientation:f})}return p}function z(t,e){for(var a=[],n=0;n<t.length;n++)a.push(g(t[n],e));return a}function I(t,e){for(var a=[],n=0;n<t.length;n++)a.push(z(t[n],e));return a}y.inverse=function(t,e,a){var n=e[0]*m,r=e[1]*m,i=a[0]*m,o=Math.asin(Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos(r)),l=((Math.sin(n)-Math.sin(o)*Math.sin(i))/(Math.cos(o)*Math.cos(i))).toFixed(6);return l=Math.acos(l),l/=m,[b(t,a[1])-l,o/m,0]},i.horizontal=y,i.add=function(t){var e={};return D(t,"type")?"dso"!==t.type||D(t,"file")&&D(t,"callback")?"line"!==t.type||D(t,"callback")?(D(t,"file")&&(e.file=t.file),e.type=t.type,D(t,"callback")&&(e.callback=t.callback),D(t,"redraw")&&(e.redraw=t.redraw),void i.data.push(e)):console.log("Can't add line"):console.log("Can't add data file"):console.log("Missing type")},i.getData=w,i.getPoint=function(t,e){return g(t,v[e])};var P={width:0,projection:"aitoff",transform:"equatorial",center:null,orientationfixed:!0,adaptable:!0,interactive:!0,form:!1,location:!1,fullwidth:!1,controls:!0,lang:"",container:"celestial-map",datapath:"data/",stars:{show:!0,limit:6,colors:!0,style:{fill:"#ffffff",opacity:1},names:!0,proper:!1,desig:!1,namestyle:{fill:"#ddddbb",font:"11px Georgia, Times, 'Times Roman', serif",align:"left",baseline:"top"},namelimit:2.5,propernamestyle:{fill:"#ddddbb",font:"11px Georgia, Times, 'Times Roman', serif",align:"right",baseline:"bottom"},propernamelimit:1.5,size:7,exponent:-.28,data:"stars.6.json"},dsos:{show:!0,limit:6,names:!0,desig:!0,namestyle:{fill:"#cccccc",font:"11px Helvetica, Arial, serif",align:"left",baseline:"top"},namelimit:4,size:null,exponent:1.4,data:"dsos.bright.json",symbols:{gg:{shape:"circle",fill:"#ff0000"},g:{shape:"ellipse",fill:"#ff0000"},s:{shape:"ellipse",fill:"#ff0000"},s0:{shape:"ellipse",fill:"#ff0000"},sd:{shape:"ellipse",fill:"#ff0000"},e:{shape:"ellipse",fill:"#ff0000"},i:{shape:"ellipse",fill:"#ff0000"},oc:{shape:"circle",fill:"#ff9900",stroke:"#ff9900",width:2},gc:{shape:"circle",fill:"#ff9900"},en:{shape:"square",fill:"#ff00cc"},bn:{shape:"square",fill:"#ff00cc"},sfr:{shape:"square",fill:"#cc00ff"},rn:{shape:"square",fill:"#0000ff"},pn:{shape:"diamond",fill:"#00cccc"},snr:{shape:"diamond",fill:"#ff00cc"},dn:{shape:"square",fill:"#999999",stroke:"#999999",width:2},pos:{shape:"marker",fill:"#cccccc",stroke:"#cccccc",width:1.5}}},constellations:{show:!0,names:!0,desig:!0,namestyle:{fill:"#cccc99",align:"center",baseline:"middle",opacity:.8,font:["14px Helvetica, Arial, sans-serif","12px Helvetica, Arial, sans-serif","11px Helvetica, Arial, sans-serif"]},lines:!0,linestyle:{stroke:"#cccccc",width:1.5,opacity:.6},bounds:!1,boundstyle:{stroke:"#ccff00",width:1,opacity:.8,dash:[2,4]}},mw:{show:!0,style:{fill:"#ffffff",opacity:"0.15"}},lines:{graticule:{show:!0,stroke:"#cccccc",width:.6,opacity:.8,lon:{pos:[""],fill:"#eee",font:"10px Helvetica, Arial, sans-serif"},lat:{pos:[""],fill:"#eee",font:"10px Helvetica, Arial, sans-serif"}},equatorial:{show:!0,stroke:"#aaaaaa",width:1.3,opacity:.7},ecliptic:{show:!0,stroke:"#66cc66",width:1.3,opacity:.7},galactic:{show:!1,stroke:"#cc6666",width:1.3,opacity:.7},supergalactic:{show:!1,stroke:"#cc66cc",width:1.3,opacity:.7}},background:{fill:"#000000",opacity:1,stroke:"#000000",width:1.5},horizon:{show:!1,stroke:null,width:1,fill:"#000000",opacity:.5},daylight:{show:!1,fill:"#fff",opacity:.4},set:function(t){var e,a,n={};if(!t)return this;for(e in this)if(D(this,e))if(D(t,e)&&null!==t[e])if(null===this[e]||this[e].constructor!=Object)n[e]=t[e];else for(a in n[e]={},this[e])D(t[e],a)?n[e][a]=t[e][a]:n[e][a]=this[e][a];else n[e]=this[e];return n}};i.settings=function(){return P};var T=d3.scale.quantize().domain([3.347,-.335]).range(["#ff4700","#ff4b00","#ff4f00","#ff5300","#ff5600","#ff5900","#ff5b00","#ff5d00","#ff6000","#ff6300","#ff6500","#ff6700","#ff6900","#ff6b00","#ff6d00","#ff7000","#ff7300","#ff7500","#ff7800","#ff7a00","#ff7c00","#ff7e00","#ff8100","#ff8300","#ff8506","#ff870a","#ff8912","#ff8b1a","#ff8e21","#ff9127","#ff932c","#ff9631","#ff9836","#ff9a3c","#ff9d3f","#ffa148","#ffa34b","#ffa54f","#ffa753","#ffa957","#ffab5a","#ffad5e","#ffb165","#ffb269","#ffb46b","#ffb872","#ffb975","#ffbb78","#ffbe7e","#ffc184","#ffc489","#ffc78f","#ffc892","#ffc994","#ffcc99","#ffce9f","#ffd1a3","#ffd3a8","#ffd5ad","#ffd7b1","#ffd9b6","#ffdbba","#ffddbe","#ffdfc2","#ffe1c6","#ffe3ca","#ffe4ce","#ffe8d5","#ffe9d9","#ffebdc","#ffece0","#ffefe6","#fff0e9","#fff2ec","#fff4f2","#fff5f5","#fff6f8","#fff9fd","#fef9ff","#f9f6ff","#f6f4ff","#f3f2ff","#eff0ff","#ebeeff","#e9edff","#e6ebff","#e3e9ff","#e0e7ff","#dee6ff","#dce5ff","#d9e3ff","#d7e2ff","#d3e0ff","#c9d9ff","#bfd3ff","#b7ceff","#afc9ff","#a9c5ff","#a4c2ff","#9fbfff","#9bbcff"]),S={airy:{n:"Airy’s Minimum Error",arg:Math.PI/2,scale:360,ratio:1,clip:!0},aitoff:{n:"Aitoff",arg:null,scale:162},armadillo:{n:"Armadillo",arg:0,scale:250},august:{n:"August",arg:null,scale:94,ratio:1.4},azimuthalEqualArea:{n:"Azimuthal Equal Area",arg:null,scale:340,ratio:1,clip:!0},azimuthalEquidistant:{n:"Azimuthal Equidistant",arg:null,scale:320,ratio:1,clip:!0},baker:{n:"Baker Dinomic",arg:null,scale:160,ratio:1.4},berghaus:{n:"Berghaus Star",arg:0,scale:320,ratio:1,clip:!0},boggs:{n:"Boggs Eumorphic",arg:null,scale:170},bonne:{n:"Bonne",arg:Math.PI/5,scale:225,ratio:.88},bromley:{n:"Bromley",arg:null,scale:162},collignon:{n:"Collignon",arg:null,scale:100,ratio:2.6},craig:{n:"Craig Retroazimuthal",arg:0,scale:310,ratio:1.5,clip:!0},craster:{n:"Craster Parabolic",arg:null,scale:160},cylindricalEqualArea:{n:"Cylindrical Equal Area",arg:Math.PI/6,scale:190,ratio:2.3},cylindricalStereographic:{n:"Cylindrical Stereographic",arg:Math.PI/4,scale:230,ratio:1.3},eckert1:{n:"Eckert I",arg:null,scale:175},eckert2:{n:"Eckert II",arg:null,scale:175},eckert3:{n:"Eckert III",arg:null,scale:190},eckert4:{n:"Eckert IV",arg:null,scale:190},eckert5:{n:"Eckert V",arg:null,scale:182},eckert6:{n:"Eckert VI",arg:null,scale:182},eisenlohr:{n:"Eisenlohr",arg:null,scale:102},equirectangular:{n:"Equirectangular",arg:null,scale:165},fahey:{n:"Fahey",arg:null,scale:196,ratio:1.4},mtFlatPolarParabolic:{n:"Flat Polar Parabolic",arg:null,scale:175},mtFlatPolarQuartic:{n:"Flat Polar Quartic",arg:null,scale:230,ratio:1.65},mtFlatPolarSinusoidal:{n:"Flat Polar Sinusoidal",arg:null,scale:175,ratio:1.9},foucaut:{n:"Foucaut",arg:null,scale:142},ginzburg4:{n:"Ginzburg IV",arg:null,scale:180,ratio:1.7},ginzburg5:{n:"Ginzburg V",arg:null,scale:196,ratio:1.55},ginzburg6:{n:"Ginzburg VI",arg:null,scale:190,ratio:1.4},ginzburg8:{n:"Ginzburg VIII",arg:null,scale:205,ratio:1.3},ginzburg9:{n:"Ginzburg IX",arg:null,scale:190,ratio:1.4},homolosine:{n:"Goode Homolosine",arg:null,scale:160,ratio:2.2},hammer:{n:"Hammer",arg:2,scale:180},hatano:{n:"Hatano",arg:null,scale:186},healpix:{n:"HEALPix",arg:1,scale:320,ratio:1.2},hill:{n:"Hill Eucyclic",arg:2,scale:190,ratio:1.1},kavrayskiy7:{n:"Kavrayskiy VII",arg:null,scale:185,ratio:1.75},lagrange:{n:"Lagrange",arg:Math.PI/4,scale:88,ratio:1.6,clip:!1},larrivee:{n:"l'Arrivée",arg:null,scale:160,ratio:1.25},laskowski:{n:"Laskowski Tri-Optimal",arg:null,scale:165,ratio:1.7},loximuthal:{n:"Loximuthal",arg:Math.PI/4,scale:175,ratio:1.8},mercator:{n:"Mercator",arg:null,scale:160,ratio:1.3},miller:{n:"Miller",arg:null,scale:160,ratio:1.5},mollweide:{n:"Mollweide",arg:null,scale:180},naturalEarth:{n:"Natural Earth",arg:null,scale:185,ratio:1.85},nellHammer:{n:"Nell Hammer",arg:null,scale:160,ratio:2.6},orthographic:{n:"Orthographic",arg:null,scale:480,ratio:1,clip:!0},patterson:{n:"Patterson Cylindrical",arg:null,scale:160,ratio:1.75},polyconic:{n:"Polyconic",arg:null,scale:160,ratio:1.3},rectangularPolyconic:{n:"Rectangular Polyconic",arg:0,scale:160,ratio:1.65},robinson:{n:"Robinson",arg:null,scale:160},sinusoidal:{n:"Sinusoidal",arg:null,scale:160,ratio:2},stereographic:{n:"Stereographic",arg:null,scale:500,ratio:1,clip:!0},times:{n:"Times",arg:null,scale:210,ratio:1.4},twoPointEquidistant:{n:"Two-Point Equidistant",arg:Math.PI/2,scale:320,ratio:1.15,clip:!0},vanDerGrinten:{n:"van Der Grinten",arg:null,scale:160,ratio:1},vanDerGrinten2:{n:"van Der Grinten II",arg:null,scale:160,ratio:1},vanDerGrinten3:{n:"van Der Grinten III",arg:null,scale:160,ratio:1},vanDerGrinten4:{n:"van Der Grinten IV",arg:null,scale:160,ratio:1.6},wagner4:{n:"Wagner IV",arg:null,scale:185},wagner6:{n:"Wagner VI",arg:null,scale:160},wagner7:{n:"Wagner VII",arg:null,scale:190,ratio:1.8},wiechel:{n:"Wiechel",arg:null,scale:360,ratio:1,clip:!0},winkel3:{n:"Winkel Tripel",arg:null,scale:196,ratio:1.7}};i.projections=function(){return S};var A={};function j(t){return document.getElementById(t)}function q(t){return t+"px"}function F(t,e){return Math.round(Math.pow(10,e)*t)/Math.pow(10,e)}function E(t){return t<10?"0"+t:t}function D(t,e){return null!==t&&hasOwnProperty.call(t,e)}function C(t){return!isNaN(parseFloat(t))&&isFinite(t)}function H(t){return"[object Array]"===Object.prototype.toString.call(t)}function O(t,e,a){var n=e.valueOf()-t.valueOf();switch(a||"d"){case"y":case"yr":n/=31556926080;break;case"m":case"mo":n/=26298e5;break;case"d":case"dy":n/=864e5;break;case"h":case"hr":n/=36e5;break;case"n":case"mn":n/=6e4;break;case"s":case"sec":n/=1e3}return Math.floor(n)}A.symbol=function(){var t,e=d3.functor("circle"),a=d3.functor(64),n=(d3.functor("#fff"),d3.functor(""));function r(t){i[e()](t)}d3.functor([2,2]);var i={circle:function(e){var n=Math.sqrt(a())/2;return e.arc(t[0],t[1],n,0,2*Math.PI),n},square:function(e){var n=Math.sqrt(a())/1.7;return e.moveTo(t[0]-n,t[1]-n),e.lineTo(t[0]+n,t[1]-n),e.lineTo(t[0]+n,t[1]+n),e.lineTo(t[0]-n,t[1]+n),e.closePath(),n},diamond:function(e){var n=Math.sqrt(a())/1.5;return e.moveTo(t[0],t[1]-n),e.lineTo(t[0]+n,t[1]),e.lineTo(t[0],t[1]+n),e.lineTo(t[0]-n,t[1]),e.closePath(),n},triangle:function(e){var n=Math.sqrt(a())/Math.sqrt(3);return e.moveTo(t[0],t[1]-n),e.lineTo(t[0]+n,t[1]+n),e.lineTo(t[0]-n,t[1]+n),e.closePath(),n},ellipse:function(e){var n=Math.sqrt(a())/2;return e.save(),e.translate(t[0],t[1]),e.scale(1.6,.8),e.beginPath(),e.arc(0,0,n,0,2*Math.PI),e.closePath(),e.restore(),n},marker:function(e){var n=Math.sqrt(a())/2;return e.moveTo(t[0],t[1]-n),e.lineTo(t[0],t[1]+n),e.moveTo(t[0]-n,t[1]),e.lineTo(t[0]+n,t[1]),e.closePath(),n},"cross-circle":function(e){var n=Math.sqrt(a()),r=n/2;return e.moveTo(t[0],t[1]-n),e.lineTo(t[0],t[1]+n),e.moveTo(t[0]-n,t[1]),e.lineTo(t[0]+n,t[1]),e.stroke(),e.beginPath(),e.moveTo(t[0],t[1]),e.arc(t[0],t[1],r,0,2*Math.PI),e.closePath(),r},"stroke-circle":function(e){var n=Math.sqrt(a()),r=n/2;return e.moveTo(t[0],t[1]-n),e.lineTo(t[0],t[1]+n),e.stroke(),e.beginPath(),e.moveTo(t[0],t[1]),e.arc(t[0],t[1],r,0,2*Math.PI),e.closePath(),r}};return r.type=function(t){return arguments.length?(e=d3.functor(t),r):e},r.size=function(t){return arguments.length?(a=d3.functor(t),r):a},r.text=function(t){return arguments.length?(n=d3.functor(t),r):n},r.position=function(e){if(arguments.length)return t=e,r},r},i.Canvas=A;var N={"stars-show":["stars-limit","stars-colors","stars-style-fill","stars-names","stars-size","stars-exponent"],"stars-names":["stars-proper","stars-desig","stars-namelimit"],"stars-proper":["stars-propernamelimit"],"dsos-show":["dsos-limit","dsos-names","dsos-size","dsos-exponent"],"dsos-names":["dsos-desig","dsos-namelimit"],"mw-show":["mw-style-opacity","mw-style-fill"],"constellations-names":["constellations-desig"]};function _(t){var e,a=t.id;switch(a){case"stars-show":e=!j(a).checked;for(var n=0;n<N[a].length;n++)L(N[a][n],e);case"stars-names":for(e=!j("stars-names").checked||!j("stars-show").checked,n=0;n<N["stars-names"].length;n++)L(N["stars-names"][n],e);case"stars-proper":for(e=!j("stars-names").checked||!j("stars-show").checked||!j("stars-proper").checked,n=0;n<N["stars-proper"].length;n++)L(N["stars-proper"][n],e);break;case"dsos-show":for(e=!j(a).checked,n=0;n<N[a].length;n++)L(N[a][n],e);case"dsos-names":for(e=!j("dsos-names").checked||!j("dsos-show").checked,n=0;n<N["dsos-names"].length;n++)L(N["dsos-names"][n],e);break;case"constellations-show":case"mw-show":for(e=!j(a).checked,n=0;n<N[a].length;n++)L(N[a][n],e)}}function L(t,e){var a=j(t);a.disabled=e,a.previousSibling.style.color=e?"#999":"#000"}function G(t,e){var a=function(t){var e=0,a=0;if(t.offsetParent)do{e+=t.offsetLeft,a+=t.offsetTop}while(null!==(t=t.offsetParent));return[e,a]}(t);d3.select("#error").html(e).style({top:q(a[1]+t.offsetHeight+1),left:q(a[0]),opacity:1}),t.focus()}function W(t){var e,a="hr"===t.id||"min"===t.id||"sec"===t.id?1:0;if(t.validity){if((e=t.validity).typeMismatch||e.badInput)return G(t,t.title+": check field value"),!1;if(e.rangeOverflow||e.rangeUnderflow)return G(t,t.title+" must be between "+(parseInt(t.min)+a)+" and "+(parseInt(t.max)-a)),!1}else{if(!C(e=t.value))return G(t,t.title+": check field value"),!1;if((e=parseFloat(e))<t.min||e>t.max)return G(t,t.title+" must be between "+(t.min+a)+" and "+(+t.max-a)),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function V(t){if(t.validity){if((e=t.validity).typeMismatch||e.badInput)return G(t,t.title+": check field value"),!1;if(-1===t.value.search(/^#[0-9A-F]{6}$/i))return G(t,t.title+": not a color value"),!1}else{var e=t.value;if(""===e)return!0;if(-1===e.search(/^#[0-9A-F]{6}$/i))return G(t,t.title+": not a color value"),!1}return d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),!0}function B(t,e){var a=j("centerx");return a?(e&&("equatorial"===t&&"equatorial"!==e?(a.value=(a.value/15).toFixed(1),a.value<0&&(a.value+=24)):"equatorial"!==t&&"equatorial"===e&&(a.value=(15*a.value).toFixed(1),a.value>180&&(a.value-=360))),"equatorial"===t?(a.min="0",a.max="24",j("cxunit").innerHTML="h"):(a.min="-180",a.max="180",j("cxunit").innerHTML="°"),a.value):null}function U(t,e){var a=j("centerx"),n=j("centery"),r=j("centerz");a&&n&&(null===t&&(t=[0,0,0]),t.length<=2&&(t[2]=0),a.value="equatorial"!==e?t[0].toFixed(1):t[0]<0?(t[0]/15+24).toFixed(1):(t[0]/15).toFixed(1),n.value=t[1].toFixed(1),r.value=null!==t[2]?t[2].toFixed(1):0)}var Y=[0,0];function R(t){var e=j("horizon-show");e&&(e.style.display=!0===t?"none":"inline-block",e.previousSibling.style.display=e.style.display)}i.zenith=function(){return Y},i.nadir=function(){var t=-Y[1],e=Y[0]+180;return e>180&&(e-=360),[e,t-.001]};var $=function(t){var e,a,n,r=new Date(wallConfig.mapOptions.date + ' ' + wallConfig.mapOptions.time),i=(d3.time.format("%Z"),[{"−12:00":720},{"−11:00":660},{"−10:00":600},{"−09:30":570},{"−09:00":540},{"−08:00":480},{"−07:00":420},{"−06:00":360},{"−05:00":300},{"−04:30":270},{"−04:00":240},{"−03:30":210},{"−03:00":180},{"−02:00":120},{"−01:00":60},{"±00:00":0},{"+01:00":-60},{"+02:00":-120},{"+03:00":-180},{"+03:30":-210},{"+04:00":-240},{"+04:30":-270},{"+05:00":-300},{"+05:30":-330},{"+05:45":-345},{"+06:00":-360},{"+06:30":-390},{"+07:00":-420},{"+08:00":-480},{"+08:30":-510},{"+08:45":-525},{"+09:00":-540},{"+09:30":-570},{"+10:00":-600},{"+10:30":-630},{"+11:00":-660},{"+12:00":-720},{"+12:45":-765},{"+13:00":-780},{"+14:00":-840}]),o=function(t){for(var e=r.getFullYear(),a=[],n=e-10;n<=e+10;n++)a.push(n);return a}(),l=d3.time.format("%Y-%m-%d"),s=d3.select("#celestial-form").append("div").attr("id","celestial-date");function c(){var t=j("mon").value,e=j("yr").value,a=new Date(e,t,1),n=d3.select("#cal"),i=new Date(wallConfig.mapOptions.date + ' ' + wallConfig.mapOptions.time);e=parseInt(e),t=parseInt(t),a.setDate(a.getDate()-a.getDay());for(var o=n.node();o.firstChild;)o.removeChild(o.firstChild);for(var s=0;s<42;s++){var c=a.getMonth(),p=a.getDay(),d=l(a);n.append("div").classed({date:!0,grey:c!==t,weekend:c===t&&(0===p||6===p),today:0===O(a,i),selected:0===O(a,r)}).attr("id",d).on("click",h).html(a.getDate().toString()),a.setDate(a.getDate()+1)}}function p(t){s.append("div").attr("id",t).on("click",function(){var e=j("mon"),a=j("yr");"left"===t?0===e.selectedIndex?(e.selectedIndex=11,a.selectedIndex--):e.selectedIndex--:11===e.selectedIndex?(e.selectedIndex=0,a.selectedIndex++):e.selectedIndex++,c()})}function d(t,e){for(var a=j(t),n=0;n<a.childNodes.length;n++)if(a.childNodes[n].value==e){a.selectedIndex=n;break}}function u(t){t&&r.setTime(t.valueOf()),d("yr",r.getFullYear()),d("mon",r.getMonth()),c(),j("hr").value=r.getHours(),j("min").value=r.getMinutes(),j("sec").value=r.getSeconds()}function f(){d3.select("#celestial-date").style("opacity",0),d3.select("#error").style({top:"-9999px",left:"-9999px",opacity:0}),d3.select("#datepick").classed("active",!1),setTimeout(function(){j("celestial-date").style.top=q(-9999)},600)}function h(){var e=j("hr").value,a=j("min").value,n=j("sec").value,i=j("tz").value;this.id&&-1!==this.id.search(/^\d/)&&(r=l.parse(this.id)),r.setHours(e,a,n),u(),t(r,i)}p("left"),e=s.append("select").attr("title","Month").attr("id","mon").on("change",c),a=0,n=r.getMonth(),e.selectAll("option").data(["January","February","March","April","May","June","July","August","September","October","November","December"]).enter().append("option").attr("value",function(t,e){return e===n&&(a=e),e}).text(function(t){return t}),e.property("selectedIndex",a),function(){var t=s.append("select").attr("title","Year").attr("id","yr").on("change",c),e=0,a=r.getFullYear();t.selectAll("option").data(o).enter().append("option").text(function(t,n){return t===a&&(e=n),t.toString()}),t.property("selectedIndex",e)}(),p("right"),s.append("div").attr("id","cal"),c(),s.append("input").attr("type","number").attr("id","hr").attr("title","Hours").attr("max","24").attr("min","-1").attr("step","1").attr("value",r.getHours()).on("change",function(){!0===W(this)&&h()}),s.append("input").attr("type","number").attr("id","min").attr("title","Minutes").attr("max","60").attr("min","-1").attr("step","1").attr("value",r.getMinutes()).on("change",function(){!0===W(this)&&h()}),s.append("input").attr("type","number").attr("id","sec").attr("title","Seconds").attr("max","60").attr("min","-1").attr("step","1").attr("value",r.getSeconds()).on("change",function(){!0===W(this)&&h()}),function(){var t=s.append("select").attr("title","Time zone offset from UTC").attr("id","tz").on("change",h),e=15,a=r.getTimezoneOffset();t.selectAll("option").data(i).enter().append("option").attr("value",function(t,n){var r=Object.keys(t)[0];return t[r]===a&&(e=n),t[r]}).text(function(t){return Object.keys(t)[0]}),t.property("selectedIndex",e)}(),this.show=function(t){var e=j("celestial-date"),a=j("datepick"),n=a.offsetLeft+a.offsetWidth-e.offsetWidth,i=a.offsetTop-e.offsetHeight-1;-9999===e.offsetTop?(r.setTime(t.valueOf()),u(),d3.select("#celestial-date").style({top:q(i),left:q(n),opacity:1}),d3.select("#datepick").classed("active",!0)):f()},this.isVisible=function(){return-9999!==j("celestial-date").offsetTop},this.hide=function(){f()}};!function(){var t=Math.PI/180,e=180/Math.PI;function a(t,e){var a=t.invert(e);return a&&isFinite(a[0])&&isFinite(a[1])&&l(a)}function n(e){var a=.5*e[0]*t,n=.5*e[1]*t,r=.5*e[2]*t,i=Math.sin(a),o=Math.cos(a),l=Math.sin(n),s=Math.cos(n),c=Math.sin(r),p=Math.cos(r);return[o*s*p+i*l*c,i*s*p-o*l*c,o*l*p+i*s*c,o*s*c-i*l*p]}function r(t,e){var a=t[0],n=t[1],r=t[2],i=t[3],o=e[0],l=e[1],s=e[2],c=e[3];return[a*o-n*l-r*s-i*c,a*l+n*o+r*c-i*s,a*s-n*c+r*o+i*l,a*c+n*s-r*l+i*o]}function i(t,e){if(t&&e){var a=function(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}(t,e),n=Math.sqrt(s(a,a)),r=.5*Math.acos(Math.max(-1,Math.min(1,s(t,e)))),i=Math.sin(r)/n;return n&&[Math.cos(r),a[2]*i,-a[1]*i,a[0]*i]}}function o(t){return[Math.atan2(2*(t[0]*t[1]+t[2]*t[3]),1-2*(t[1]*t[1]+t[2]*t[2]))*e,Math.asin(Math.max(-1,Math.min(1,2*(t[0]*t[2]-t[3]*t[1]))))*e,Math.atan2(2*(t[0]*t[3]+t[1]*t[2]),1-2*(t[2]*t[2]+t[3]*t[3]))*e]}function l(e){var a=e[0]*t,n=e[1]*t,r=Math.cos(n);return[r*Math.cos(a),r*Math.sin(a),Math.sin(n)]}function s(t,e){for(var a=0,n=t.length,r=0;a<n;++a)r+=t[a]*e[a];return r}d3.geo.zoom=function(){var t,e,c,p=0,d=function(t){for(var e=0,a=arguments.length,n=[];++e<a;)n.push(arguments[e]);var r=d3.dispatch.apply(null,n);return r.of=function(e,a){return function(n){try{var i=n.sourceEvent=d3.event;n.target=t,d3.event=n,r[n.type].apply(e,a)}finally{d3.event=i}}},r}(u,"zoomstart","zoom","zoomend"),u=d3.behavior.zoom().on("zoomstart",function(){var e=d3.mouse(this),l=n(t.rotate()),s=a(t,e);s&&(c=s),f.call(u,"zoom",function(){t.scale(h.k=d3.event.scale);var n=d3.mouse(this),s=i(c,a(t,n));t.rotate(h.r=o(l=s?r(l,s):r(function(t,e,a){var n=t.translate(),r=Math.atan2(e[1]-n[1],e[0]-n[0])-Math.atan2(a[1]-n[1],a[0]-n[0]);return[Math.cos(r/2),0,0,Math.sin(r/2)]}(t,e,n),l))),e=n,g(d.of(this,arguments))}),m(d.of(this,arguments))}).on("zoomend",function(){f.call(u,"zoom",null),v(d.of(this,arguments))}),f=u.on,h={r:[0,0,0],k:1};function m(t){p++||t({type:"zoomstart"})}function g(t){t({type:"zoom"})}function v(t){--p||t({type:"zoomend"})}return u.rotateTo=function(t){var e=i(l(t),l([-h.r[0],-h.r[1]]));return o(r(n(h.r),e))},u.projection=function(e){return arguments.length?(h={r:(t=e).rotate(),k:t.scale()},u.scale(h.k)):t},u.duration=function(t){return arguments.length?(e=t,u):e},u.event=function(a){a.each(function(){var a=d3.select(this),r=d.of(this,arguments),i=h,l=d3.transition(a);if(l!==a){l.each("start.zoom",function(){this.__chart__&&(h=this.__chart__),t.rotate(h.r).scale(h.k),m(r)}).tween("zoom:zoom",function(){var a=u.size()[0],c=function(t,e){var a=Math.max(-1,Math.min(1,s(t,e))),n=a<0?-1:1,r=Math.acos(n*a),i=Math.sin(r);return i?function(a){var o=n*Math.sin((1-a)*r)/i,l=Math.sin(a*r)/i;return[t[0]*o+e[0]*l,t[1]*o+e[1]*l,t[2]*o+e[2]*l,t[3]*o+e[3]*l]}:function(){return t}}(n(h.r),n(i.r)),p=d3.geo.distance(h.r,i.r),d=d3.interpolateZoom([0,0,a/h.k],[p,0,a/i.k]);return e&&l.duration(e(.001*d.duration)),function(e){var n=d(e);this.__chart__=h={r:o(c(n[0]/p)),k:a/n[2]},t.rotate(h.r).scale(h.k),u.scale(h.k),g(r)}}).each("end.zoom",function(){v(r)});try{l.each("interrupt.zoom",function(){v(r)})}catch(t){console.log(t)}}else this.__chart__=h,m(r),g(r),v(r)})},d3.rebind(u,d,"on")}}(),this.Celestial=i}();